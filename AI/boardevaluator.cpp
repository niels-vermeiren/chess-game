#include "boardevaluator.h"

QList<QList<double>> BoardEvaluator::pawnWhiteTable = {
    { 10.0,  10.0,  10.0,  10.0,  10.0,  10.0,  10.0,  10.0 },
    { 5.0,  5.0,  5.0,  5.0,  5.0,  5.0,  5.0,  5.0 },
    { 1.0,  1.0,  2.0,  3.0,  3.0,  2.0,  1.0,  1.0 },
    { 0.5,  0.5,  1.0,  2.5,  2.5,  1.0,  0.5,  0.5 },
    { 0.0,  0.0,  0.0,  5.0,  5.0,  0.0,  0.0,  0.0 },
    { 0.5, -0.5, -1.0,  0.0,  0.0, -1.0, -0.5,  0.5 },
    { 0.5,  1.0, 1.0,  -2.0, -2.0,  1.0,  1.0,  0.5 },
    { 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0 }
};

QList<QList<double>> BoardEvaluator::pawnBlackTable = {
    { 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0 },
    { 0.5,  1.0, 1.0,  -2.0, -2.0,  1.0,  1.0,  0.5 },
    { 0.5, -0.5, 7.0,  0.0,  0.0, -1.0, -0.5,  0.5 },
    { 0.0,  0.0,  0.0,  5.0,  8.0,  0.0,  0.0,  0.0 },
    { 0.5,  0.5,  1.0,  5.5,  5.5,  1.0,  0.5,  0.5 },
    { 1.0,  1.0,  2.0,  3.0,  3.0,  2.0,  1.0,  1.0 },
    { 5.0,  5.0,  5.0,  5.0,  5.0,  5.0,  5.0,  5.0 },
    { 10.0, 10.0,  10.0,  10.0,  10.0,  10.0,  10.0,  10.0 },
};

QList<QList<double>> BoardEvaluator::knightTable = {
    { -5.0, -10.0, -3.0, -3.0, -3.0, -3.0, -5.0, -5.0 },
    { -4.0, -2.0,  -2.0,  -3.0,  -3.0,  -2.0, -2.0, -4.0 },
    { -3.0,  0.0,  1.0,  1.5,  1.5,  1.0,  0.0, -3.0 },
    { -3.0,  0.5,  1.5,  2.0,  2.0,  1.5,  0.5, -3.0 },
    { -3.0,  0.0,  1.5,  2.0,  2.0,  1.5,  0.0, -3.0 },
    { -3.0,  0.5,  1.0,  1.5,  1.5,  1.0,  0.5, -3.0 },
    { -4.0, -2.0,  0.0,  0.5,  0.5,  0.0, -2.0, -4.0 },
    { -5.0, -5.0, -3.0, -3.0, -3.0, -3.0, -5.0, -5.0 }
};

QList<QList<double>> BoardEvaluator::bishopWhiteTable = {
    { -2.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -2.0 },
    { -1.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0, -1.0 },
    { -1.0,  0.0,  0.5,  1.0,  1.0,  0.5,  0.0, -1.0 },
    { -1.0,  0.5,  0.5,  1.0,  1.0,  0.5,  0.5, -1.0 },
    { -1.0,  0.0,  1.0,  1.0,  1.0,  1.0,  0.0, -1.0 },
    { -1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0, -1.0 },
    { -1.0,  0.5,  0.0,  0.0,  0.0,  0.0,  0.5, -1.0 },
    { -2.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -2.0 }
};

QList<QList<double>> BoardEvaluator::bishopBlackTable = {
    { -2.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -2.0 },
    { -1.0,  0.5,  0.0,  0.0,  0.0,  0.0,  0.5, -1.0 },
    { -1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0, -1.0 },
    { -1.0,  0.0,  1.0,  1.0,  1.0,  1.0,  0.0, -1.0 },
    { -1.0,  0.5,  0.5,  1.0,  1.0,  0.5,  0.5, -1.0 },
    { -1.0,  0.0,  0.5,  1.0,  1.0,  0.5,  0.0, -1.0 },
    { -1.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0, -1.0 },
    { -2.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -2.0 },
};

QList<QList<double>> BoardEvaluator::rookWhiteTable = {
    {  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0 },
    {  0.5,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  0.5 },
    { -0.5,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0, -0.5 },
    { -0.5,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0, -0.5 },
    { -0.5,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0, -0.5 },
    { -0.5,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0, -0.5 },
    { -0.5,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0, -0.5 },
    {  0.0,  0.0, 0.0,  0.5,  0.5,  0.0,  0.0,  0.0 }
};

QList<QList<double>> BoardEvaluator::rookBlackTable = {
    {  0.0,  0.0, 0.0,  0.5,  0.5,  0.0,  0.0,  0.0 },
    { -0.5,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0, -0.5 },
    { -0.5,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0, -0.5 },
    { -0.5,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0, -0.5 },
    { -0.5,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0, -0.5 },
    { -0.5,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0, -0.5 },
    {  0.5,  1.0,  1.0,  1.0,  1.0,  1.0,  1.0,  0.5 },
    {  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0 },
};

QList<QList<double>> BoardEvaluator::queenTable = {
    { -2.0, -1.0, -1.0, -0.5, -0.5, -1.0, -1.0, -2.0 },
    { -1.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0, -1.0 },
    { -1.0,  0.0,  2.5,  2.5,  2.5,  2.5,  0.0, -1.0 },
    { -0.5,  0.0,  2.5,  2.5,  2.5,  2.5,  0.0, -0.5 },
    {  0.0,  0.0,  2.5,  2.5,  2.5,  2.5,  0.0, -0.5 },
    { -1.0,  2.5,  2.5,  2.5,  2.5,  2.5,  0.0, -1.0 },
    { -1.0,  0.0,  2.5,  0.0,  0.0,  0.0,  0.0, -1.0 },
    { -2.0, -1.0, -1.0, -0.5, -0.5, -1.0, -1.0, -2.0 }
};

QList<QList<double>> BoardEvaluator::kingWhiteTable = {
    { -3.0, -4.0, -4.0, -5.0, -5.0, -4.0, -4.0, -3.0 },
    { -3.0, -4.0, -4.0, -5.0, -5.0, -4.0, -4.0, -3.0 },
    { -3.0, -4.0, -4.0, -5.0, -5.0, -4.0, -4.0, -3.0 },
    { -3.0, -4.0, -4.0, -5.0, -5.0, -4.0, -4.0, -3.0 },
    { -2.0, -3.0, -3.0, -4.0, -4.0, -3.0, -3.0, -2.0 },
    { -1.0, -2.0, -2.0, -2.0, -2.0, -2.0, -2.0, -1.0 },
    {  2.0,  2.0,  0.0,  0.0,  0.0,  0.0,  2.0,  2.0 },
    {  2.0,  3.0,  1.0,  0.0,  0.0,  1.0,  3.0,  2.0 }
};

QList<QList<double>> BoardEvaluator::kingBlackTable = {
    {  2.0,  3.0,  1.0,  0.0,  0.0,  1.0,  3.0,  2.0 },
    {  2.0,  2.0,  0.0,  0.0,  0.0,  0.0,  2.0,  2.0 },
    { -1.0, -2.0, -2.0, -2.0, -2.0, -2.0, -2.0, -1.0 },
    { -2.0, -3.0, -3.0, -4.0, -4.0, -3.0, -3.0, -2.0 },
    { -3.0, -4.0, -4.0, -5.0, -5.0, -4.0, -4.0, -3.0 },
    { -3.0, -4.0, -4.0, -5.0, -5.0, -4.0, -4.0, -3.0 },
    { -3.0, -4.0, -4.0, -5.0, -5.0, -4.0, -4.0, -3.0 },
    { -3.0, -4.0, -4.0, -5.0, -5.0, -4.0, -4.0, -3.0 },
};

int BoardEvaluator::evaluateBoard(QList<QList<Square *>> board) {

    double sum = 0;
    for(int i = 0; i != board.count(); i++) {
        for(int j = 0; j != board[0].count(); j++) {
            Piece * piece = board[i][j]->getPieceOnSquare();
            if (piece->pieceType() == "") continue;
            int score = piece->pieceColour() == "black" ? piece->getScore() : -piece->getScore();
            if (piece->pieceType() == "♛") {
                score += queenTable[i][j];
            }
            if (piece->pieceType() == "♞") {
                score += knightTable[i][j];
            }
            if (piece->pieceType() == "♟") {
                score += piece->pieceColour() == "black" ? pawnBlackTable[i][j] : pawnWhiteTable[i][j];
            }
            if (piece->pieceType() == "♜") {
                score += piece->pieceColour() == "black" ? rookBlackTable[i][j] : rookWhiteTable[i][j];
            }
            if (piece->pieceType() == "♝") {
                score += piece->pieceColour() == "black" ? bishopBlackTable[i][j] : bishopWhiteTable[i][j];
            }
            if (piece->pieceType() == "♚") {
                score += piece->pieceColour() == "black" ? kingBlackTable[i][j] : kingWhiteTable[i][j];
            }
            sum += score;
        }
    }
    return sum;
}
